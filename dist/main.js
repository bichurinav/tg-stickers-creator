"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _defineProperty(e,t,o){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:String(e)}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var o=e[Symbol.toPrimitive];if(void 0===o)return("string"===t?String:Number)(e);o=o.call(e,t||"default");if("object"!=_typeof(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}var creator=new fabric.Canvas("canvas",{preserveObjectStacking:!0}),deleteIcon="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='utf-8'%3F%3E%3C!DOCTYPE svg PUBLIC '-//W3C//DTD SVG 1.1//EN' 'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3E%3Csvg version='1.1' id='Ebene_1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' width='595.275px' height='595.275px' viewBox='200 215 230 470' xml:space='preserve'%3E%3Ccircle style='fill:%23F44336;' cx='299.76' cy='439.067' r='218.516'/%3E%3Cg%3E%3Crect x='267.162' y='307.978' transform='matrix(0.7071 -0.7071 0.7071 0.7071 -222.6202 340.6915)' style='fill:white;' width='65.545' height='262.18'/%3E%3Crect x='266.988' y='308.153' transform='matrix(0.7071 0.7071 -0.7071 0.7071 398.3889 -83.3116)' style='fill:white;' width='65.544' height='262.179'/%3E%3C/g%3E%3C/svg%3E",cloneIcon="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAABYgAAAWIBXyfQUwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAO1SURBVHic7ZvLaxNBHMe/v0lb+0h6UEsfqCUiFCxaPIiIFz0oRbx7tXjQNFhQ+xDxUbWK1gqCpSiC9h/woKAo+Dr5uBTbUqFUmlCktIogNVZbs/PzIEmzNhXcndlJ6H4OYWc2v99898tkdmYzS9BE7Y2vYSFElIkaCQgDKNXV1hIkAIyB8Igl9cajwalsXyIdLYf7ZtoA6gJQpCP//0PfiWTLeKT8zqIzqpsK9327COCk6ryKaIk1h25kVig1IHwzsRuSn6jOq5AkM22NR4PvUhVCaXqJC8jdiweAAiI+l1mhTGy490ctRDKuKp9G5gPJ+YoPLatmAIU9gAK/NqnKpZkiGSiuSxWUGcBSrFSVSzcWYXXqWJ0BkGrHE40EkExrzRvRuvANMC3ANMvegIJ/naxsHdxGQjQKcBhkX8xI5pdT3Q19euXpJ6sBVR3v6onpFkA7AAYD+POxgCD6rl+efhYZUHVieCdJfgAgZECP59jGgJqOkXUk+R6WycUDfw+CbJ0HkDczOhWkDajoHAkysN+kGBOkDQjM8lYAxQa1GGFhTkyy2qQQU6QNkDJXnt95y7KfCfoGmBZgGt8A0wJM4xtgWoBpfANMCzCNb4BpAabxDTAtwDS+AaYFmMY3wLQA0/gGOA1kSbZYgpDu5XiDhYK0VscGEPEqe9n64kaUlwQEPqeOnfcAoMaetWgYi/5BzEnmCgtnR1MFN2PAxpVHxspThfFDJRMA3rpR5gmEx6MHK76lim4MWFFU+rPRnptOI7d7QRJEZzMrXN0FSHIkszzeHHwKwiU3ObVCOBo7HBzMrHJ3GyTsrGob2ptZFYuEToGoFcCcq9xqSTBzUywS6v37hPt5AOH22vYB24AYiwSvQRbUAdwDwjBgZDPFDBEGAHShkDbEo+X92b6U3ipb1TZ0gAh3nbTEwGurNLDnc2d9wplWcyiZCRKwvXDWelXZOhhWkc9LFO4UxSYhaKCmfahjzdFXJary6kbJTyAL0wDuM9EDwfKDJfFxuqchJzdV6TLAc4jQP3llc9P/xvmrQdMCTOMbsHDIebOez4ZkZ2uQBQOEyJv1/BJ8chKU8eaEyJf1fFYIGHYSlzZg8kr9BANv1EnylMSKeeuhk0DbIMiCTyEPewEzrsavb/nqJNZmwPTlhucEdKmR5Q0MPJsq++L4GcSi2+Bk9+YzYBwD8NOVMv0wEfqLS0P70Lkr6TTJkm+OVh9/X0sBKwpwIwPrAZQ5bUQhcwAmmfCCmW9Pdze4HrN+A5hc8Qv3J7e7AAAAAElFTkSuQmCC",deleteImg=document.createElement("img"),cloneImg=(deleteImg.src=deleteIcon,document.createElement("img")),controlDelete=(cloneImg.src=cloneIcon,{x:.5,y:-.5,offsetY:-16,offsetX:16,cursorStyle:"pointer",mouseUpHandler:deleteObject,render:renderIcon(deleteImg),cornerSize:24}),controlClone={x:-.5,y:-.5,offsetY:-16,offsetX:-16,cursorStyle:"pointer",mouseUpHandler:cloneObject,render:renderIcon(cloneImg),cornerSize:24};function renderIcon(l){return function(e,t,o,r,n){var c=this.cornerSize;e.save(),e.translate(t,o),e.rotate(fabric.util.degreesToRadians(n.angle)),e.drawImage(l,-c/2,-c/2,c,c),e.restore()}}function deleteObject(e,t){var t=t.target,o=t.canvas;o.remove(t),o.currentSelectedObject=null,o.requestRenderAll()}function cloneObject(e,t){var o=t.target,r=o.canvas;o.clone(function(e){e.left+=10,e.top+=10;o.$dropdown&&(e=fabric.util.object.extend(e,{$dropdown:o.$dropdown})),"textbox"===o.__proto__.type&&(e=fabric.util.object.extend(e,{isFontBold:o.isFontBold,isFontItalic:o.isFontItalic,isFontUnderline:o.isFontUnderline,isFontThrough:o.isFontThrough,sizeStroke:o.sizeStroke,choosenFont:o.choosenFont,strokeColor:o.strokeColor})),"image"!==o.__proto__.type&&(e=fabric.util.object.extend(e,{color:o.color})),r.add(e),r.updateEventListeners(),r.setActiveObject(e)})}function getStateObject(e){var t;e.isFontBold&&creator.$fontBoldToolButton.classList.add("button--active"),e.isFontItalic&&creator.$fontItalicToolButton.classList.add("button--active"),e.isFontUnderline&&creator.$fontUnderlineToolButton.classList.add("button--active"),e.isFontThrough&&creator.$fontThroughToolButton.classList.add("button--active"),e.$dropdown&&e.$dropdown.state&&(creator.currentSelectedObject.$dropdown.el.parentNode.classList.add("button--active"),creator.currentSelectedObject.$dropdown.el.classList.add("dropdown--active"),creator.currentSelectedObject.$dropdown.el.querySelector("#color-input"))&&(t=e.color||"#FFF",creator.$colorpicker.setColor(t)),e.choosenFont&&(creator.$selectFont.el.value=e.choosenFont,creator.$selectFont.update()),creator.$selectWidthStroke&&(creator.$selectWidthStroke.el.value=null!=(t=e.sizeStroke)?t:"0",creator.$selectWidthStroke.update()),e.strokeColor&&(t=e.strokeColor||"#000",creator.$colorStrokePicker.setColor(t))}function enableButtonsList(e){e&&e.forEach(function(e){e.classList.add("enable")})}function offButtonsList(e){e&&e.forEach(function(e){e.classList.remove("enable"),e.children[2]&&(e.children[2].classList.remove("dropdown--active"),e.classList.remove("button--active"))})}fabric.Textbox.prototype.controls.deleteControl=new fabric.Control(controlDelete),fabric.Object.prototype.controls.deleteControl=new fabric.Control(controlDelete),fabric.Object.prototype.controls.clone=new fabric.Control(controlClone),fabric.Textbox.prototype.controls.clone=new fabric.Control(controlClone),fabric.Object.prototype.checkInsideCanvas=function(){function e(){var e=t.getBoundingRect();return e.left>creator.getWidth()-5||e.top>creator.getWidth()-5||e.width+e.left<20||e.height+e.top<20}var t=this;this.on("modified",function(){e()&&creator.centerObject(this)}),this.on("scaling",function(){e()&&creator.centerObject(this)})},fabric.Object.prototype.toggleActiveButton=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;e.classList.contains("button--active")?(e.classList.remove("button--active"),t&&t(!1)):(e.classList.add("button--active"),t&&t(!0))},fabric.Canvas.prototype.currentSelectedObject=null,fabric.Canvas.prototype.updateEventListeners=function(){var t=this;this._objects.forEach(function(e){e.off("selected"),e.off("deselected"),e.on("selected",function(){t.currentSelectedObject=e,t.currentTypeSelected=e.__proto__.type,"textbox"===t.currentTypeSelected&&enableButtonsList(t.buttonsTextList),"image"!==t.currentTypeSelected&&(creator.$colorpicker.setColor(t.currentSelectedObject.color||"#FFF"),enableButtonsList(t.buttonsFigureList)),enableButtonsList(t.buttonsSwapList),getStateObject(t.currentSelectedObject),e.checkInsideCanvas()}),e.on("deselected",function(){"textbox"===t.currentTypeSelected&&(t.$fontBoldToolButton.classList.remove("button--active"),t.$fontItalicToolButton.classList.remove("button--active"),t.$fontUnderlineToolButton.classList.remove("button--active"),t.$fontThroughToolButton.classList.remove("button--active")),offButtonsList(t.buttonsTextList),offButtonsList(t.buttonsFigureList),offButtonsList(t.buttonsSwapList),t.currentSelectedObject=null,t.currentTypeSelected=null})})},fabric.Canvas.prototype.setAllTextsToFront=function(){var t=this;this._objects.forEach(function(e){"textbox"===e.__proto__.type&&t.bringForward(e,!0)})},fabric.Canvas.prototype.imageUpload=function(e){var t=this,o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;fabric.Image.fromURL(e,function(e){e.scale(.5),t.add(e),t.setAllTextsToFront(),t.updateEventListeners(),t.setActiveObject(e),t.centerObject(e),o&&o()})},fabric.Canvas.prototype.loadFont=function(e){var t=this,o=new FontFaceObserver(e);o.load().then(function(){t.currentSelectedObject.set({fontFamily:o.family,fontSize:40}),t.renderAll()}).catch(function(e){console.log(e)})},fabric.Canvas.prototype.addText=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=new fabric.Textbox("Текст...",_defineProperty(_defineProperty(_defineProperty(_defineProperty({fill:"#FFF",fontSize:39,editable:!0,breakWords:!0},"editable",!0),"breakWords",!0),"strokeWidth",0),"stroke","#000"));this.add(t),this.bringForward(t,!0),this.updateEventListeners(),this.setActiveObject(t),this.centerObject(t),this.$colorpicker.setColor("#FFF"),this.$colorStrokePicker.setColor("#000"),this.loadFont(this.choosenFont||"Roboto"),this.requestRenderAll(),e&&(t.set(e),this.renderAll())},fabric.Canvas.prototype.addRect=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=new fabric.Rect({fill:"#FFF",width:150,height:150,left:30,top:30});this.add(t),this.setAllTextsToFront(),this.sendToBack(t),this.updateEventListeners(),this.setActiveObject(t),this.$colorpicker.setColor("#FFF"),this.requestRenderAll(),e&&(t.set(e),this.renderAll())},fabric.Canvas.prototype.addCircle=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=new fabric.Circle({radius:65,fill:"#FFF",width:150,height:150,left:30,top:30});this.add(t),this.setAllTextsToFront(),this.sendToBack(t),this.updateEventListeners(),this.setActiveObject(t),this.$colorpicker.setColor("#FFF"),this.requestRenderAll(),e&&(t.set(e),this.renderAll())};var $addTextButton=document.getElementById("add-text"),$upObjectButton=document.getElementById("up-object"),$downObjectButton=document.getElementById("down-object"),buttonsSwapList=document.querySelectorAll(".button--swap"),dropdowns=(creator.buttonsSwapList=buttonsSwapList,[]),$imageUpload=(creator.imageUpload("./dist/img/placeholder.png",function(){initFontTool(),initColorTool(),initFigureTool(),creator.addText({top:100,fontFamily:"Roboto"})}),$addTextButton.addEventListener("click",function(){creator.addText()}),$upObjectButton.addEventListener("click",function(){creator.bringForward(creator.currentSelectedObject),creator.renderAll()}),$downObjectButton.addEventListener("click",function(){creator.sendToBack(creator.currentSelectedObject),creator.renderAll()}),document.getElementById("image-upload")),imageUploadFiles=document.querySelectorAll(".image-upload-file");function toggleDropdown(e){closeAllDropdowns(e),e.addEventListener("click",function(e){e.stopPropagation()}),e.parentNode.classList.contains("button--active")?e.classList.add("dropdown--active"):(e.classList.remove("dropdown--active"),e.querySelector("#color-input")&&(e=creator.currentSelectedObject.color||"#FFF",creator.$colorpicker.setColor(e)))}function closeAllDropdowns(t){dropdowns.forEach(function(e){e.offsetParent.id!==t.offsetParent.id&&e.classList.contains("dropdown--active")&&(e.classList.remove("dropdown--active"),e.parentNode.classList.remove("button--active"))})}function initFontTool(){var e=document.querySelectorAll(".button--font"),t=document.getElementById("font-tool"),o=document.getElementById("font-bold-tool"),r=document.getElementById("font-italic-tool"),n=document.getElementById("font-underline-tool"),c=document.getElementById("font-through-tool"),l=t.querySelector(".dropdown"),i=(dropdowns.push(l),NiceSelect.bind(document.getElementById("font-select"))),a=NiceSelect.bind(document.getElementById("width-stroke-select"));creator.$selectFont=i,creator.$selectWidthStroke=a,creator.$fontBoldToolButton=o,creator.$fontItalicToolButton=r,creator.$fontUnderlineToolButton=n,creator.$fontThroughToolButton=c,creator.buttonsTextList=e,creator.$selectFont.el.value="Roboto",creator.$selectWidthStroke.el.value="0",creator.$selectFont.update(),creator.$selectWidthStroke.update(),creator.$selectFont.el.addEventListener("change",function(e){"textbox"===creator.currentTypeSelected&&(e=e.target.value,creator.choosenFont=e,creator.currentSelectedObject.choosenFont=e,creator.loadFont(e))}),creator.$selectWidthStroke.el.addEventListener("change",function(e){"textbox"===creator.currentTypeSelected&&(e=e.target.value,creator.currentSelectedObject.sizeStroke=e,creator.currentSelectedObject.set({strokeWidth:Number(e)}),creator.renderAll())}),creator.$fontBoldToolButton.addEventListener("click",function(e){"textbox"===creator.currentTypeSelected&&creator.currentSelectedObject.toggleActiveButton(creator.$fontBoldToolButton,function(e){creator.currentSelectedObject.isFontBold=e,creator.currentSelectedObject.set({fontWeight:e?"bold":"normal"}),creator.renderAll()})}),creator.$fontItalicToolButton.addEventListener("click",function(e){"textbox"===creator.currentTypeSelected&&creator.currentSelectedObject.toggleActiveButton(creator.$fontItalicToolButton,function(e){creator.currentSelectedObject.isFontItalic=e,creator.currentSelectedObject.set({fontStyle:e?"italic":"normal"}),creator.renderAll()})}),creator.$fontUnderlineToolButton.addEventListener("click",function(e){"textbox"===creator.currentTypeSelected&&creator.currentSelectedObject.toggleActiveButton(creator.$fontUnderlineToolButton,function(e){creator.currentSelectedObject.isFontUnderline=e,creator.currentSelectedObject.set({underline:e}),creator.renderAll()})}),creator.$fontThroughToolButton.addEventListener("click",function(e){"textbox"===creator.currentTypeSelected&&creator.currentSelectedObject.toggleActiveButton(creator.$fontThroughToolButton,function(e){creator.currentSelectedObject.isFontThrough=e,creator.currentSelectedObject.set({linethrough:e}),creator.renderAll()})}),t.addEventListener("click",function(){"textbox"===creator.currentTypeSelected&&creator.currentSelectedObject.toggleActiveButton(t,function(e){creator.currentSelectedObject.$dropdown={state:e,el:l},toggleDropdown(l)})})}function initColorTool(){var e=document.getElementById("color-tool"),t=e.querySelector(".dropdown"),o=(dropdowns.push(t),new Huebee("#color-input",{saturations:2,staticOpen:!0,hues:8})),r=new Huebee("#color-stroke-input",{saturations:2,staticOpen:!0,hues:8});creator.$colorpicker=o,creator.$colorStrokePicker=r,creator.$colorToolButton=e,creator.$colorStrokePicker.setColor("#000"),creator.$colorpicker.on("change",function(e){"image"!==creator.currentTypeSelected&&(creator.currentSelectedObject.color=e,creator.currentSelectedObject.set({fill:e}),creator.renderAll())}),creator.$colorStrokePicker.on("change",function(e){"textbox"===creator.currentTypeSelected&&(creator.currentSelectedObject.strokeColor=e,creator.currentSelectedObject.set({stroke:e}),creator.renderAll())}),e.addEventListener("click",function(){"image"!==creator.currentTypeSelected&&creator.currentSelectedObject.toggleActiveButton(e,function(e){creator.currentSelectedObject.$dropdown={state:e,el:t},toggleDropdown(t)})})}function initFigureTool(){var e=document.querySelectorAll(".button--figure"),t=document.getElementById("add-rect"),o=document.getElementById("add-circle");creator.buttonsFigureList=e,creator.$buttonAddRect=t,creator.$buttonAddCircle=o,creator.$buttonAddRect.addEventListener("click",function(){creator.addRect()}),creator.$buttonAddCircle.addEventListener("click",function(){creator.addCircle()})}imageUploadFiles.forEach(function(e,t){e.addEventListener("change",function(e){var e=e.target.files[0],t=new FileReader;t.onload=function(e){e=e.target.result;creator.imageUpload(e)},t.readAsDataURL(e)})});